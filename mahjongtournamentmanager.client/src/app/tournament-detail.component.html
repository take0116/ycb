<div class="mahjong-background">
  <div *ngIf="tournament" class="tournament-detail-container">
    <div class="navigation-header">
      <button routerLink="/event-list" class="back-button">＜ 戻る</button>
    </div>

    <div class="mahjong-tile tournament-title">
      <h2>{{ tournament.tournamentName }}</h2>
    </div>

    <div class="mahjong-tile detail-section">
      <h3>開催情報</h3>
      <p><strong>期間:</strong> {{ tournament.startDate | date:'yyyy/MM/dd' }} - {{ tournament.endDate | date:'yyyy/MM/dd' }}</p>
      <p><strong>状態:</strong> <span class="status-label status-{{tournament.status}}">{{ tournament.status === 0 ? '企画中' : (tournament.status === 1 ? '募集中' : (tournament.status === 2 ? '募集終了' : '終了')) }}</span></p>
    </div>

    <div class="mahjong-tile detail-section">
      <h3>ルール</h3>
      <div class="rules-grid">
        <p><strong>参加人数:</strong> {{ tournament.playerCount }}人</p>
        <p><strong>対戦形式:</strong> {{ tournament.gameType }}</p>
        <p><strong>長考時間:</strong> {{ tournament.thinkTime }}</p>
        <p><strong>飛び:</strong> {{ tournament.allowFlying ? 'あり' : 'なし' }}</p>
        <p><strong>赤ドラ:</strong> {{ tournament.redDora ? 'あり' : 'なし' }}</p>
        <p><strong>配給原点:</strong> {{ tournament.startingScore }}点</p>
      </div>
    </div>

    <div class="mahjong-tile detail-section" *ngIf="tournament.description">
      <h3>コメント</h3>
      <p class="comment-box">{{ tournament.description }}</p>
    </div>

    <div class="action-section">
      <div>
        <button *ngIf="!isParticipant && tournament.status === 1" (click)="joinTournament()" class="mahjong-button join-button">
          <span class="dragon-green">参加</span>する
        </button>
        <button *ngIf="isParticipant" (click)="viewParticipantsOnly()" class="mahjong-button view-participants-button">
          <span class="dragon-red">参加者</span>専用
        </button>
      </div>
      <div class="admin-actions" *ngIf="authService.hasRole('Admin')">
        <button (click)="editTournament()" class="mahjong-button edit-button">編集</button>
        <button (click)="deleteTournament()" class="mahjong-button delete-button">削除</button>
      </div>
    </div>

    <div class="mahjong-tile detail-section" *ngIf="isParticipant && authService.hasRole('Admin')">
      <h3>参加者一覧</h3>
      <table class="participants-table" *ngIf="participants.length > 0; else noParticipants">
        <thead>
          <tr>
            <th>参加者名</th>
            <th>登録日時</th>
            <th class="actions-column">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let participant of participants">
            <td>{{ participant.user.userName }}</td>
            <td>{{ participant.joinedDate | date:'yyyy/MM/dd HH:mm:ss' }}</td>
            <td class="actions-column">
              <button (click)="removeParticipant(participant.userId)" class="mahjong-button remove-participant-button">取消</button>
            </td>
          </tr>
        </tbody>
      </table>
      <ng-template #noParticipants>
        <p>まだ参加者はいません。</p>
      </ng-template>
    </div>
  </div>

  <div *ngIf="!tournament && !message" class="loading-message">
    <p>読み込み中...</p>
  </div>

  <div *ngIf="!tournament && message" class="error-message">
    <p>{{ message }}</p>
  </div>
</div>
